<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Embedded Nero - Joe v0.7.0 User&#x27;s Guide</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../changes.html">Change Log</a></li><li class="chapter-item expanded affix "><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Language Reference</li><li class="chapter-item expanded "><a href="../language.html"><strong aria-hidden="true">1.</strong> The Joe Language</a></li><li class="chapter-item expanded "><a href="../types.html"><strong aria-hidden="true">2.</strong> Types and Values</a></li><li class="chapter-item expanded "><a href="../operators.html"><strong aria-hidden="true">3.</strong> Operators</a></li><li class="chapter-item expanded "><a href="../statements.html"><strong aria-hidden="true">4.</strong> Statements</a></li><li class="chapter-item expanded "><a href="../functions.html"><strong aria-hidden="true">5.</strong> Functions</a></li><li class="chapter-item expanded "><a href="../classes.html"><strong aria-hidden="true">6.</strong> Classes</a></li><li class="chapter-item expanded "><a href="../records.html"><strong aria-hidden="true">7.</strong> Records</a></li><li class="chapter-item expanded "><a href="../patterns.html"><strong aria-hidden="true">8.</strong> Pattern Matching</a></li><li class="chapter-item expanded "><a href="../introspection.html"><strong aria-hidden="true">9.</strong> Introspection</a></li><li class="chapter-item expanded "><a href="../nero/nero.html"><strong aria-hidden="true">10.</strong> Nero Datalog</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../nero/nero_tutorial.html"><strong aria-hidden="true">10.1.</strong> Nero Tutorial</a></li><li class="chapter-item expanded "><a href="../nero/embedded_nero.html" class="active"><strong aria-hidden="true">10.2.</strong> Embedded Nero</a></li><li class="chapter-item "><a href="../nero/ruleset_reference.html"><strong aria-hidden="true">10.3.</strong> 'ruleset' Reference</a></li><li class="chapter-item "><a href="../nero/technical_details.html"><strong aria-hidden="true">10.4.</strong> Technical Details</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Embedding and Extending Joe</li><li class="chapter-item expanded "><a href="../embedding/embedding.html"><strong aria-hidden="true">11.</strong> Embedding Joe</a></li><li class="chapter-item expanded "><a href="../extending/extending.html"><strong aria-hidden="true">12.</strong> Extending Joe</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../extending/java_types.html"><strong aria-hidden="true">12.1.</strong> Joe and Java Data Types</a></li><li class="chapter-item "><a href="../extending/native_functions.html"><strong aria-hidden="true">12.2.</strong> Native Functions</a></li><li class="chapter-item "><a href="../extending/registered_types.html"><strong aria-hidden="true">12.3.</strong> Registered Types</a></li><li class="chapter-item "><a href="../extending/packages.html"><strong aria-hidden="true">12.4.</strong> Joe Packages</a></li><li class="chapter-item "><a href="../extending/native_classes.html"><strong aria-hidden="true">12.5.</strong> Native Classes</a></li><li class="chapter-item "><a href="../extending/native_records.html"><strong aria-hidden="true">12.6.</strong> Native Records</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Joe Tools</li><li class="chapter-item expanded "><a href="../joe_version.html"><strong aria-hidden="true">13.</strong> joe version</a></li><li class="chapter-item expanded "><a href="../joe_run.html"><strong aria-hidden="true">14.</strong> joe run</a></li><li class="chapter-item expanded "><a href="../joe_repl.html"><strong aria-hidden="true">15.</strong> joe repl</a></li><li class="chapter-item expanded "><a href="../joe_test.html"><strong aria-hidden="true">16.</strong> joe test</a></li><li class="chapter-item expanded "><a href="../joe_doc.html"><strong aria-hidden="true">17.</strong> joe doc</a></li><li class="chapter-item expanded "><a href="../joe_nero.html"><strong aria-hidden="true">18.</strong> joe nero</a></li><li class="chapter-item expanded affix "><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Library Reference</li><li class="chapter-item expanded "><a href="../library/index.html"><strong aria-hidden="true">19.</strong> Library API</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../library/pkg.joe.html"><strong aria-hidden="true">19.1.</strong> Joe Standard Library (joe)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../library/type.joe.AssertError.html"><strong aria-hidden="true">19.1.1.</strong> AssertError Type</a></li><li class="chapter-item "><a href="../library/type.joe.Boolean.html"><strong aria-hidden="true">19.1.2.</strong> Boolean Type</a></li><li class="chapter-item "><a href="../library/type.joe.CatchResult.html"><strong aria-hidden="true">19.1.3.</strong> CatchResult Type</a></li><li class="chapter-item "><a href="../library/type.joe.Error.html"><strong aria-hidden="true">19.1.4.</strong> Error Type</a></li><li class="chapter-item "><a href="../library/type.joe.Fact.html"><strong aria-hidden="true">19.1.5.</strong> Fact Type</a></li><li class="chapter-item "><a href="../library/type.joe.Function.html"><strong aria-hidden="true">19.1.6.</strong> Function Type</a></li><li class="chapter-item "><a href="../library/type.joe.Joe.html"><strong aria-hidden="true">19.1.7.</strong> Joe Type</a></li><li class="chapter-item "><a href="../library/type.joe.Keyword.html"><strong aria-hidden="true">19.1.8.</strong> Keyword Type</a></li><li class="chapter-item "><a href="../library/type.joe.List.html"><strong aria-hidden="true">19.1.9.</strong> List Type</a></li><li class="chapter-item "><a href="../library/type.joe.Map.html"><strong aria-hidden="true">19.1.10.</strong> Map Type</a></li><li class="chapter-item "><a href="../library/type.joe.Number.html"><strong aria-hidden="true">19.1.11.</strong> Number Type</a></li><li class="chapter-item "><a href="../library/type.joe.Opaque.html"><strong aria-hidden="true">19.1.12.</strong> Opaque Type</a></li><li class="chapter-item "><a href="../library/type.joe.RuleSet.html"><strong aria-hidden="true">19.1.13.</strong> RuleSet Type</a></li><li class="chapter-item "><a href="../library/type.joe.Set.html"><strong aria-hidden="true">19.1.14.</strong> Set Type</a></li><li class="chapter-item "><a href="../library/type.joe.String.html"><strong aria-hidden="true">19.1.15.</strong> String Type</a></li><li class="chapter-item "><a href="../library/type.joe.TextBuilder.html"><strong aria-hidden="true">19.1.16.</strong> TextBuilder Type</a></li><li class="chapter-item "><a href="../library/type.joe.Type.html"><strong aria-hidden="true">19.1.17.</strong> Type Type</a></li></ol></li><li class="chapter-item "><a href="../library/pkg.joe.test.html"><strong aria-hidden="true">19.2.</strong> Joe Test Tool API (joe.test)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../library/type.joe.test.CatchChecker.html"><strong aria-hidden="true">19.2.1.</strong> CatchChecker Type</a></li><li class="chapter-item "><a href="../library/type.joe.test.JoeTest.html"><strong aria-hidden="true">19.2.2.</strong> JoeTest Type</a></li><li class="chapter-item "><a href="../library/type.joe.test.ValueChecker.html"><strong aria-hidden="true">19.2.3.</strong> ValueChecker Type</a></li></ol></li><li class="chapter-item "><a href="../library/pkg.joe.doc.html"><strong aria-hidden="true">19.3.</strong> JoeDoc Configuration API (joe.doc)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../library/type.joe.doc.DocConfig.html"><strong aria-hidden="true">19.3.1.</strong> DocConfig Type</a></li></ol></li><li class="chapter-item "><a href="../library/pkg.joe.console.html"><strong aria-hidden="true">19.4.</strong> Console API (joe.console)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../library/type.joe.console.Console.html"><strong aria-hidden="true">19.4.1.</strong> Console Type</a></li><li class="chapter-item "><a href="../library/type.joe.console.Path.html"><strong aria-hidden="true">19.4.2.</strong> Path Type</a></li></ol></li><li class="chapter-item "><a href="../library/pkg.joe.win.html"><strong aria-hidden="true">19.5.</strong> GUI API (joe.win)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../library/type.joe.win.Control.html"><strong aria-hidden="true">19.5.1.</strong> Control Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.Button.html"><strong aria-hidden="true">19.5.2.</strong> Button Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.GridPane.html"><strong aria-hidden="true">19.5.3.</strong> GridPane Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.HBox.html"><strong aria-hidden="true">19.5.4.</strong> HBox Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.HPos.html"><strong aria-hidden="true">19.5.5.</strong> HPos Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.Insets.html"><strong aria-hidden="true">19.5.6.</strong> Insets Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.Label.html"><strong aria-hidden="true">19.5.7.</strong> Label Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.ListView.html"><strong aria-hidden="true">19.5.8.</strong> ListView Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.Menu.html"><strong aria-hidden="true">19.5.9.</strong> Menu Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.MenuBar.html"><strong aria-hidden="true">19.5.10.</strong> MenuBar Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.MenuItem.html"><strong aria-hidden="true">19.5.11.</strong> MenuItem Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.Node.html"><strong aria-hidden="true">19.5.12.</strong> Node Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.Orientation.html"><strong aria-hidden="true">19.5.13.</strong> Orientation Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.Pane.html"><strong aria-hidden="true">19.5.14.</strong> Pane Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.Pos.html"><strong aria-hidden="true">19.5.15.</strong> Pos Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.Priority.html"><strong aria-hidden="true">19.5.16.</strong> Priority Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.Region.html"><strong aria-hidden="true">19.5.17.</strong> Region Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.Separator.html"><strong aria-hidden="true">19.5.18.</strong> Separator Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.Side.html"><strong aria-hidden="true">19.5.19.</strong> Side Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.SplitPane.html"><strong aria-hidden="true">19.5.20.</strong> SplitPane Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.StackPane.html"><strong aria-hidden="true">19.5.21.</strong> StackPane Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.Tab.html"><strong aria-hidden="true">19.5.22.</strong> Tab Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.TabPane.html"><strong aria-hidden="true">19.5.23.</strong> TabPane Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.VBox.html"><strong aria-hidden="true">19.5.24.</strong> VBox Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.VPos.html"><strong aria-hidden="true">19.5.25.</strong> VPos Type</a></li><li class="chapter-item "><a href="../library/type.joe.win.Win.html"><strong aria-hidden="true">19.5.26.</strong> Win Type</a></li></ol></li><li class="chapter-item "><a href="../library/index.html"><strong aria-hidden="true">19.6.</strong> Library API Index</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded affix "><a href="../grammar.html">Appendix: Joe Grammar</a></li><li class="chapter-item expanded affix "><a href="../vm.html">Appendix: Clark Virtual Machine</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Joe v0.7.0 User&#x27;s Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="embedded-nero"><a class="header" href="#embedded-nero">Embedded Nero</a></h1>
<p>This section explains how to use Nero within Joe scripts.</p>
<ul>
<li><a href="#a-simple-rule-set">A Simple Rule Set</a></li>
<li><a href="#the-fact-type">The <code>Fact</code> Type</a></li>
<li><a href="#scripted-input-facts">Scripted Input Facts</a></li>
<li><a href="#exporting-domain-values">Exporting Domain Values</a></li>
</ul>
<h2 id="a-simple-rule-set"><a class="header" href="#a-simple-rule-set">A Simple Rule Set</a></h2>
<p>A Nero program is embedded in a Joe script using the <code>ruleset</code>
expression.  The following declaration defines a
<a href="../library/type.joe.RuleSet.html"><code>RuleSet</code></a>
called <code>myRules</code>. The content of the expression's body is just a
Nero program, as described in the <a href="nero_tutorial.html">tutorial</a>,
possibly augmented with
<a href="#exported-outputs"><code>export</code> declarations</a>.</p>
<pre><code class="language-joe">var myRules = ruleset {
    // Parent/2 - parent, child
    Parent(#anne, #bert);
    Parent(#bert, #clark);

    // Ancestor/2 - ancestor, descendant
    Ancestor(x, y) :- Parent(x, y);
    Ancestor(x, y) :- Parent(x, z), Ancestor(z, y);
};
</code></pre>
<p>A <a href="../library/type.joe.RuleSet.html"><code>RuleSet</code></a> provides a number of
ways to infer the facts resulting from the rules; the simplest is
<code>infer()</code>, which simply executes the rule set as is, given any
defined axioms, and returns the resulting facts.</p>
<pre><code class="language-joe">foreach (fact : myRules.infer()) {
    println(fact);
}
</code></pre>
<p>This will output the following:</p>
<pre><code>Fact(Ancestor, #anne, #bert)
Fact(Ancestor, #bert, #clark)
Fact(Parent, #anne, #bert)
Fact(Parent, #bert, #clark)
Fact(Ancestor, #anne, #clark)
</code></pre>
<h2 id="the-fact-type"><a class="header" href="#the-fact-type">The 'Fact' Type</a></h2>
<p>By default, all new facts inferred by an embedded Nero rule set are of
type <a href="../library/type.joe.Fact.html"><code>Fact</code></a>.  A <code>Fact</code> consists of a
relation, e.g., <code>"Ancestor"</code>, and a list of terms, e.g., <code>#anne</code> and
<code>#bert</code>.</p>
<p>In most ways a <code>Fact</code> value can be treated like an
<em>ad hoc</em> Joe record value, i.e., the same pattern that will match a record of
type <code>Ancestor</code> will also match a <code>Fact</code> whose relation is <code>"Ancestor"</code>:</p>
<pre><code class="language-joe">foreach (Ancestor(a, d) : myRules.infer()) {
    println(a + " is an ancestor of " + d);
}
</code></pre>
<p>When inferred facts are going to be used immediately, e.g., to produce
output, the <code>Fact</code> type is often sufficient.  However, it is also possible
to make the rule set produce outputs using the script's own defined
types; see <a href="#exported-domain-values">Exported Domain Values</a>, below.</p>
<h2 id="scripted-input-facts"><a class="header" href="#scripted-input-facts">Scripted Input Facts</a></h2>
<p>A Nero rule set can include axioms, as shown above, but usually it gets its
input facts from the script.  Any Joe value with named fields can be used
as an input fact.  This includes instances of:</p>
<ul>
<li>The <a href="../library/type.joe.Fact.html"><code>Fact</code></a> type.</li>
<li>Any Joe <a href="../records.html">record</a> type.</li>
<li>Any joe <a href="../classes.html">class</a>.</li>
<li>Native types whose proxies define fields.</li>
<li>Any native type whose proxy explicitly overrides <code>isFact</code> and <code>toFact</code> to
do something sensible in context.</li>
</ul>
<p>The type's type name is used as the input fact's relation, and its
fields as the fact's terms.</p>
<p>The scripts a list or set of all of the input facts, and passes it
to the rule set's <code>infer()</code> method.</p>
<pre><code class="language-joe">record Parent(parent, child) {}

var inputs = [
    Parent(#anne, #bert),
    Parent(#bert, #clark)
];

var myRules = ruleset {
    // Ancestor/2 - ancestor, descendant
    Ancestor(x, y) :- Parent(x, y);
    Ancestor(x, y) :- Parent(x, z), Ancestor(z, y);
};

foreach (fact : myRules.infer(inputs)) {
    println(fact);
}
</code></pre>
<h3 id="input-facts-without-ordered-fields"><a class="header" href="#input-facts-without-ordered-fields">Input Facts without Ordered Fields</a></h3>
<p>Class instances do not have ordered fields the way <code>Fact</code> values and record
values do. Therefore, the usual rule syntax that depends on
ordered fields will not work:</p>
<pre><code class="language-joe">class Parent {
    method init(parent, child) {
        @parent = parent;
        @child = child;
    }
}

var myRules = ruleset {
    // Parent(x, y) cannot match an instance of class parent!
    Ancestor(x, y) :- Parent(x, y);
    Ancestor(x, y) :- Parent(x, z), Ancestor(z, y);
};
</code></pre>
<p>Consequently, we must use named-field atoms for class instances
and other types with named fields but not ordered fields:</p>
<pre><code class="language-joe">var myRules = ruleset {
    Ancestor(x, y) :- Parent(parent: x, child: y);
    Ancestor(x, y) :- Parent(parent: x, child: z), Ancestor(z, y);
};
</code></pre>
<p>Named-field atoms also allow a rule to match on a subset of a fact's
fields, whether ordered or not.</p>
<h2 id="exported-domain-values"><a class="header" href="#exported-domain-values">Exported Domain Values</a></h2>
<p>As noted <a href="#the-fact-type">above</a>, a rule set outputs inferred facts
using the <a href="../library/type.joe.Fact.html"><code>Fact</code></a> type.  This is sufficient
in many cases; but it is also common to want the outputs to be of types
defined by the script itself.  Accomplish this by adding <code>export</code>
declarations to the rule set.</p>
<p>The simplest <code>export</code> declaration simply states that a given relation
has a matching domain type in the current scope. When rule set execution
is complete, facts with the exported relation will be converted to
values of the named type using the type's initializer.</p>
<p>For example, the following script defines a record type called
<code>Ancestor</code> and tells the rule set to export all <code>Ancestor</code> facts using
the <code>Ancestor</code> type.</p>
<pre><code class="language-joe">record Ancestor(ancestor, dependent) {}

var myRules = ruleset {
    export Ancestor;
    Ancestor(x, y) :- Parent(x, y);
    Ancestor(x, y) :- Parent(x, z), Ancestor(z, y);
};
</code></pre>
<ul>
<li>The <code>Ancestor</code> type must be in scope when the rule set is defined.</li>
<li>The <code>Ancestor</code> type's initializer must take the same number of arguments
as the <code>Ancestor</code> relation in the rule set.</li>
</ul>
<p>However, it is also possible to export an inferred fact as any kind of
value the script's author desires by providing an explicit creation
function as a callable reference.  For example, suppose the script
author wants <code>Ancestor</code> facts returned as two-item lists:</p>
<pre><code class="language-joe">function ancestor2list(x, y) {
    return [x, y];
}

var myRules = ruleset {
    export Ancestor as ancestor2list;
    Ancestor(x, y) :- Parent(x, y);
    Ancestor(x, y) :- Parent(x, z), Ancestor(z, y);
};
</code></pre>
<p>A lambda function could also be used:</p>
<pre><code class="language-joe">var myRules = ruleset {
    export Ancestor as \x,y -&gt; [x, y];
    Ancestor(x, y) :- Parent(x, y);
    Ancestor(x, y) :- Parent(x, z), Ancestor(z, y);
};
</code></pre>
<p>The only restriction is that the callable referenced by the <code>as</code> clause
is defined in the scope in which the rule set is declared.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../nero/nero_tutorial.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../nero/ruleset_reference.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../nero/nero_tutorial.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../nero/ruleset_reference.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
